<!DOCTYPE html>
<head>
    <style type="text/css">
        body {
            font: normal normal 14px/1.2 'Helvetica Neue', Arial, sans-serif;
        }

        .container {
            display:flex;
        }

        .left_side {
            width: 50%; 
            padding: 2px;
        }

        .right_side {
            flex-grow: 1;
            padding: 2px;
            max-width: 500px;
        }

        hr {
            margin-left:0px;
            margin-top: 28px;
            max-width:350px;
        }

        optgroup {
            color: red;
            background-color: black;
        }

        option {
           color: black;
        }

        .modify_td_key {
            text-align: right;
            font-weight: bold;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script id="rendered-js">
        $(function() {
            $('#modify_elective_assignment_sessionNumber').change(function() {
                $('#removeFromElective option').remove();
                $('#removeFromElective optgroup').remove();
                $('#addToElective option').remove();
                $('#addToElective optgroup').remove();
                $('#modify_assignment_student option:first').prop('selected', true)
            });
        });

        $(function() {
            $('#modify_assignment_student').change(function() {
                studentID = $("option:selected", $(this)).attr('value')
                targetSession = $("option:selected", $('#modify_elective_assignment_sessionNumber')).attr('value')

                if (studentID == "no_name") {
                    return
                }

                $.getJSON("/_json_/student_assignments", {"sID": studentID, "session": targetSession}, function(data) {
                    if (data['error']) {
                        alert("Error: " + data['error'])
                    }
                    else {
                        enrolled = data["enrolled"]
                        available = data["available"]

                        $('#removeFromElective option').remove();
                        $('#removeFromElective optgroup').remove();

                        $('#removeFromElective').get(0).options.add(new Option(text="No change", value="no_change"))
                        optGroup = null;
                        $.each(enrolled, function(idx) {
                            se = enrolled[idx]
                            if (optGroup == null || optGroup.label != se["day"]) {
                                optGroup = document.createElement('optgroup')
                                optGroup.label = se["day"]
                                $('#removeFromElective').get(0).options.add(optGroup)
                            }
                            $('#removeFromElective').get(0).options.add(new Option(text=se["name"] + " ("+ se["seats_left"] +" left)", value=se["id"]))
                        });

                        $('#addToElective option').remove();
                        $('#addToElective optgroup').remove();

                        $('#addToElective').get(0).options.add(new Option(text="No change", value="no_change"))
                        optGroup = null;
                        $.each(available, function(idx) {
                            se = available[idx]
                            if (optGroup == null || optGroup.label != se["day"] + ' R' + se["rotation"]) {
                                optGroup = document.createElement('optgroup')
                                optGroup.label = se["day"] + ' R' + se["rotation"]
                                $('#addToElective').get(0).options.add(optGroup)
                            }
                            $('#addToElective').get(0).options.add(new Option(text=se["name"] + " ("+ se["seats_left"] +" left)", value=se["id"]))
                        });
                    }
                });
            });
        });
    </script>
</head>
<body>
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul class=flashes>
        {% for category, message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
{% endwith %}
<div class="container">
    <div class="left_side">
        <form method=post enctype=multipart/form-data action="/_admin_">
        <input type="hidden" name="formID" value="startSession">
        <table>
            <thead>
                <td colspan="2"><strong>Please be careful here...</strong> updating this changes the active session!</td>
            </thead>
            <tbody>
                <tr>
                    <td>Current Session #</td>
                    <td>
                        <select id="sessionNumber" name="sessionNumber">
                            <option name="1">1</option>
                            <option name="2">2</option>
                            <option name="3">3</option>
                            <option name="4">4</option>
                        </select>
                    </td>    
                </tr>
                <tr>
                    <td style="vertical-align: top;"><label for="sessionStartDate">Registration start date</label>
                        <p>
                            Order goes:<br>
                            1: Paolini-Ruiz-Bishop<br>
                            2: Ruiz-Bishop-Paolini<br>
                            3: Bishop-Paolini-Ruiz<br>
                            4: Paolini-Ruiz-Bishop<br>
                        </p>
                    </td>
                    <td>
                        <input type="text" name="sessionStartDate" id="sessionStartDate" placeholder="YYYY-MM-DD" pattern="\d{4}-\d{2}-\d{2}">
                    </td>    
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>
                        <button class="submitButton" type="submit">Submit</button>
                    </td>    
                </tr>
            </tbody>
        </table>
        </form>
        <hr style="max-width:350px;margin-left:0px;">
        <p>
            Generally speaking, go in the order presented here otherwise you'll probably encounter errors (some tables need data from the ones before it)
        </p>
        <p>
            <strong>Session Upload:</strong><p>
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type="hidden" name="formID" value="session_upload">
                <input type=file name="sessions">
                <input type=submit value=Upload>
            </form>
        </p>
        <hr style="max-width:350px;margin-left:0px;">
        <p>
            <strong>Roster Upload:</strong> Student count in database: {{ studentCount }}<p>
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type="hidden" name="formID" value="roster_upload">
                <input type=file name="roster">
                <input type=submit value=Upload>
            </form>
        </p>
        <hr style="max-width:350px;margin-left:0px;">
        <p>
            <strong>Elective Upload:</strong><p>
                Note: if you must re-upload electives, you have to re-upload assignments as well<br>
                (After clearing out SessionElective, Elective, and Assignment databases, in that order)
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type="hidden" name="formID" value="elective_upload">
                Session #: <select name="sessionNumber">
                    <option name="1">1</option>
                    <option name="2">2</option>
                    <option name="3">3</option>
                    <option name="4">4</option>
                </select>
                <br>
                <input type=file name="electives">
                <input type=submit value=Upload>
            </form>
        </p>
        <hr style="max-width:350px;margin-left:0px;">
        <p>
            <strong>Specific Assignment Upload:</strong><p>
                When you need to assign students to specific classes. The file you upload here must have student names that match exactly to the roster.
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type="hidden" name="formID" value="specific_assignment">
                Session #: <select name="sessionNumber">
                    <option name="1">1</option>
                    <option name="2">2</option>
                    <option name="3">3</option>
                    <option name="4">4</option>
                </select>
                <br>
                <input type=file name="assignments">
                <input type=submit value=Upload>
            </form>
        </p>
    </div>
    <div class = "right_side">
        <p>
            <strong>CSV Schedules Download:</strong><p>
                CSVs of the enrolled student schedules for the current session.
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type = "hidden" name="formID" value="csv_schedules">
                <input type = "submit" value="Download Schedules">
            </form>
        </p>
        <hr style="max-width:350px;margin-left:0px;">
        <p>
            <strong>Enrollment Overview Download:</strong><p>
                Download a view of enrollment over the entire student body.
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type = "hidden" name="formID" value="enrollment_overview">
                <input type = "submit" value="Download Overview">
            </form>
        </p>
        <hr style="max-width:350px;margin-left:0px;">
        <p>
            <strong>Schedule of Electives Download:</strong><p>
                A schedule of what electives are happening when for the current session.
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type = "hidden" name="formID" value="elective_schedules">
                <input type = "checkbox" name="includeSeatsRemaining"> include seats remaining<br>
                <input type = "submit" value="Download Schedule">
            </form>
        </p>
        <hr style="max-width:350px;margin-left:0px;">
        <p>
            <strong>Modify Assignments:</strong><p>
                Allows you to move students around as needed. Does not take into account occupancy, so you can overload a class if you'd like.
            <form method=post enctype=multipart/form-data action="/_admin_">
                <input type = "hidden" name="formID" value="modify_elective_assignment">
                <table id="modify_elective_assignment_table">
                    <tr>
                        <td class="modify_td_key">Session:</td>
                        <td>
                            <select name="modify_elective_assignment_sessionNumber" id="modify_elective_assignment_sessionNumber">
                                <option value="current" selected>current</option>
                                <option value="1">#1</option>
                                <option value="2">#2</option>
                                <option value="3">#3</option>
                                <option value="4">#4</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="modify_td_key">Student:</td>
                        <td>
                            <select name="modify_assignment_student" id="modify_assignment_student">
                                <option value="no_name" selected disabled>Pick a student</option>
                                {% for student in students %}
                                    <option value="{{ student.id }}">{{ student.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="modify_td_key">Add to:</td>
                        <td>
                            <select name="addToElective" id="addToElective">

                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="modify_td_key">Remove from:</td>
                        <td>
                            <select name="removeFromElective" id="removeFromElective">

                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
                            <input type = "submit" value="Modify Schedule">
                        </td>
                    </tr>
                </table>
            </form>
        </p>
    </div>
</div>
</body>
</html>